<!--charts.js tutorial https://simpleisbetterthancomplex.com/tutorial/2020/01/19/how-to-use-chart-js-with-django.html-->
<!--https://stackoverflow.com/questions/24555823/multiple-chartjs-in-the-same-page/40401048-->
<!--format datetime for html form https://stackoverflow.com/questions/63099974/django-template-convert-datetime-local-format-->
{% block content %}
<a href="{% url 'polls:index'%}">Threads</a>
<h2> {{ thread_info.title }} </h2>

<h3>{{thread_info.date_time}}</h3>
<h3>{{thread_info.last_date_scraped}}</h3>

<!-- info for dateRangePicker https://www.daterangepicker.com-->
<script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
<input type="text" name="datetimes" />
<script type="text/javascript">
$(function() {
  $('input[name="datetimes"]').daterangepicker({
    timePicker: true,
    startDate: "{{thread_info.date_time|date:'m-d-Y'}}{{thread_info.date_time|time:'H:i:s'}}",
    endDate: "{{thread_info.last_date_scraped|date:'m-d-Y'}}{{thread_info.last_date_scraped|time:'H:i:s'}}",
    minDate: "{{thread_info.date_time|date:'m-d-Y'}}{{thread_info.date_time|time:'H:i:s'}}",
    maxDate: "{{thread_info.last_date_scraped|date:'m-d-Y'}}{{thread_info.last_date_scraped|time:'H:i:s'}}",
    locale: {
      format: 'MM/DD/YYYY hh:mm A'
    }
  });
});
</script>

<br>
<!-- add the charts.js library to page -->
<!-- create two variables (sentiment_for_quotes, sentiment_for_no_quotes) that will use the data passed from views.py
pie_chart method to create pie charts using the charts.js lib -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
<!--
<div id="container" style="width: 75%;">
    <canvas id="sentiment-pie-chart"></canvas>
  </div>
  <script>
    var sentiment_for_quotes = {
      type: 'pie',
      data: {
        datasets: [{
          data: {{ sentiment_with_quotes_data|safe }},
          backgroundColor: [
          "#FFF9A6",
          "#FF7F7F",
          "#56d798",
          ],
          label: 'Sentiment'
        }],
        labels: {{ sentiment_pie_chart_labels|safe }}
      },
      options: {
        responsive: true,
        title: {
            display: true,
            text: 'Sentiment Quotes'
        }
      }
    };

  </script>
<br>
-->

  <div id="container_2" style="width: 75%;">
    <canvas id="sentiment-pie-chart-2"></canvas>
  </div>

  <script>

    var sentiment_for_no_quotes = {
      type: 'pie',
      data: {
        datasets: [{
          data: {{ sentiment_no_quotes_data|safe }},
          backgroundColor: [
          "#FFF9A6",
          "#FF7F7F",
          "#56d798",
          ],
          label: 'Sentiment'
        }],
        labels: {{ sentiment_pie_chart_labels|safe }}
      },
      options: {
        responsive: true,
        title: {
            display: true,
            text: 'Sentiment No Quotes'
        }
      }
    };

      </script>
<br>
  <div id="container_3" style="width: 75%;">
    <canvas id="total_replies_bar"></canvas>
  </div>

  <script>

  var total_replies_datetime_bar_chart = {
      type: 'line',
      data: {
        datasets: [{
          data: {{ total_replies_datetime_bar_chart_data|safe }},
          borderColor: 'rgb(75, 192, 192)',
          tension: 0.1,
          label: 'Total Replies',
          fill: 'false'
        }],
        labels: {{ total_replies_datetime_bar_chart_labels|safe }}
      },
      options: {
        title: {
            display: true,
            text: 'Total Replies'
         },
        scales: {
          responsive: true,
          yAxes: [{
            ticks: {
                //will start the bar chart at zero
                beginAtZero: true,
                //precision 0 will for only integers i.e. will not use 1.5
                precision: 0,
            }
          }]
        }
      }
    };

    </script>

<br>
  <div id="container_4" style="width: 75%;">
    <canvas id="total_replies_username_bar"></canvas>
  </div>

  <script>

  var total_replies_username_bar_chart = {
      type: 'bar',
      data: {
        datasets: [{
          data: {{ total_replies_by_username_data|safe }},
          //using a single color without an array[] will cause all bars to be the same color
          backgroundColor:
            '#fdd835',
          label: 'Total Replies'
        }],
        labels: {{ total_replies_by_username_labels|safe }}
      },
      options: {
        title: {
            display: true,
            text: 'User Total Replies'
         },
        responsive: true,
        scales: {
          yAxes: [{
            ticks: {
                //will start the bar chart at zero
                beginAtZero: true,
                //precision 0 will for only integers i.e. will not use 1.5
                precision: 0,
            }
          }]
        }
      }
    };
    </script>
<br>
  <div id="container_5" style="width: 75%;">
    <canvas id="most_frequent_words_bar"></canvas>
  </div>

  <script>

  var most_frequent_words_bar_chart = {
      type: 'horizontalBar',
      data: {
        datasets: [{
          data: {{ most_frequent_words_sorted_df_data|safe }},
          //using a single color without an array[] will cause all bars to be the same color
          backgroundColor:
            '#90EE90',
          label: 'Word Total'
        }],
        labels: {{ most_frequent_words_sorted_df_labels|safe }}
      },
      options: {
        title: {
            display: true,
            text: 'Most Frequent Words'
         },
        responsive: true,
        scales: {
          xAxes: [{
            ticks: {
                //will start the bar chart at zero
                beginAtZero: true,
                //precision 0 will for only integers i.e. will not use 1.5
                precision: 0,
            }
          }]
        }
      }
    };
    </script>

<br>
  <div id="container_6" style="width: 75%;">
    <canvas id="total_thread_views_replies_pie"></canvas>
  </div>

  <script>
    var total_thread_views_replies_pie_chart = {
      type: 'pie',
      data: {
        datasets: [{
          data: {{ total_thread_views_and_replies_list|safe }},
          backgroundColor: [
          "#FF7F7F",
          "#FFF9A6"
          ],
          label: 'Total'
        }],
        labels: {{ total_thread_views_and_replies_labels|safe }}
      },
      options: {
        responsive: true,
        title: {
            display: true,
            text: 'Thread Views and Replies'
        }
      }
    };

      window.onload = function() {
      /*
      var ctx = document.getElementById('sentiment-pie-chart').getContext('2d');
      window.myPie = new Chart(ctx, sentiment_for_quotes);
      */

      var ctx_2 = document.getElementById('sentiment-pie-chart-2').getContext('2d');
      window.myPie_2 = new Chart(ctx_2, sentiment_for_no_quotes);

      var ctx_3 = document.getElementById('total_replies_bar').getContext('2d');
      window.myBar = new Chart(ctx_3, total_replies_datetime_bar_chart);

      var ctx_4 = document.getElementById('total_replies_username_bar').getContext('2d');
      window.myBar = new Chart(ctx_4, total_replies_username_bar_chart);

      var ctx_5 = document.getElementById('most_frequent_words_bar').getContext('2d');
      window.myBar = new Chart(ctx_5, most_frequent_words_bar_chart);

      var ctx_6 = document.getElementById('total_thread_views_replies_pie').getContext('2d');
      window.myPie_2 = new Chart(ctx_6, total_thread_views_replies_pie_chart);


    };

  </script>

{% endblock %}